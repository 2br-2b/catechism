{"version":3,"sources":["cccMetaGenerator/makeUrlMap.ts","components/common/hooks/useScrollToTopOnRouteChange.ts","components/PageBreadcrumbs/PageBreadcrumbs.tsx","components/HighlightWrapper/HighlightWrapper.tsx","components/Page/PageParagraph.tsx","components/Page/PageFootnotes.tsx","utils/reactRouterUtils.ts","components/Page/PageControls.tsx","components/Page/Page.tsx","cccMetaGenerator/makeRefRangeTree.ts","components/CCCReference/CCCReference.tsx","components/Search/createSearchIndexHelpers.ts","components/Search/createSearchIndex.ts","components/Home/Home.tsx","components/Index/Index.tsx","components/Search/Search.tsx","components/Search/useSearchIndexHook.ts","components/common/featureFlags.ts","components/Search/SearchResultCard.tsx","components/Search/SearchResults.tsx","serviceWorker.ts","index.tsx","components/App.tsx","components/Page/pageScrollHooks.ts","components/Footer/Footer.tsx","components/Layout/Layout.tsx"],"names":["makeUrlToTocMap","tocIdToUrlMap","Object","entries","reduce","acc","_ref","_ref2","_Users_gibson_cheng_IdeaProjects_catechism_web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__","tocId","url","urlWithoutShortLink","stripUrlShortLink","_Users_gibson_cheng_IdeaProjects_catechism_web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","_Users_gibson_cheng_IdeaProjects_catechism_web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","SHORT_LINK_PATTERN","replace","__webpack_require__","d","__webpack_exports__","useScrollToTopOnPathChange","react__WEBPACK_IMPORTED_MODULE_0__","path","useEffect","window","scrollTo","useStyles","makeStyles","container","padding","paddingBottom","breadcrumbs","fontFamily","PageBreadcrumbs","props","store","currentPageId","_store$extraMeta","extraMeta","breadcrumbsMap","pageMetaMap","tocNodes","toc_nodes","styles","breadcrumbTrail","findPageBreadcrumbTrail","map","getTocNode","lastIndex","length","react_default","a","createElement","className","Breadcrumbs","createHomeBreadcrumb","createBreadcrumbLink","currentTocId","current","parent","concat","toConsumableArray","react_router_dom","to","APP_ROUTES","INDEX","IconButton","size","Book","tocNode","index","text","id","breadcrumbText","isLastIndex","createShortenedBreadcrumbText","createBreadcrumbText","pageMeta","key","textsToReplace","shortenedText","currText","args","toLowerCase","numberInText","getNumberInText","FIRST_NUMBER_PATTERN","matches","match","HighlightWrapper","children","_props$refMeta","refMeta","emptyRefMeta","highlighted","ref","classnames","wrapper","defineProperty","backgroundColor","transitionProperty","transitionDuration","createRef","PageParagraph","paragraph","wrapperRefMeta","elements","attrs","HighlightWrapper_HighlightWrapper","paragraphIndented","indent","renderParagraphElement","element","type","number","PageParagraph_WithElementStyles","href","link","cccReferenceStyle","ref_number","WithElementStyles","_classnames2","_element$attrs","elementTextDefaults","elementTextBold","b","elementTextItalicised","i","lineHeight","margin","marginTop","marginLeft","marginRight","borderLeft","paddingLeft","display","fontWeight","fontStyle","PageFootnotes","footnotes","wrapperRefMetas","footnoteKeys","keys","pageFootnotesContainer","pageFootnoteLabel","footnote","getFootnoteRefKey","PageFootnotes_PageFootnote","PageFootnote","refs","footnoteNumberElement","footnoteRefStyle","pageFootnote","renderFootnoteRefs","curr","shouldAddComma","renderedRef","commaElement","fontSize","color","historyPush","history","push","PageControls","cccStore","_pageMetaMap$tocId","next","prev","hasNext","hasUrl","hasPrev","Box","pageControls","pageControlButton","pageLeftButton","onClick","getUrl","KeyboardArrowLeft","pageRightButton","KeyboardArrowRight","paddingTop","border","PAGE_TOC_ID_MATCH","Page","location","shortUrl","getShortUrl","getPageTocId","pageNode","getPageNode","elementRefs","usePageScrollHooks","search","paragraphs","emptyTrailingParagraphIndexes","getTrailingEmptyParagraphIndexes","Layout","routeHistory","PageBreadcrumbs_PageBreadcrumbs","pageContainer","has","getParagraphRefKey","PageParagraph_PageParagraph","PageFootnotes_PageFootnotes","PageControls_PageControls","fullUrl","params","urlMap","page_nodes","emptyParagraphIndexes","reduceRight","ignoreRest","slicedToArray","isEmptyParagraph","objectSpread","indexes","Set","CCC_REFERENCE_MATCH","CCCReference_CCCReference","CCCReference","cccReferenceMatch","isNumber","cccReferenceNumber","parseInt","matchedPageId","cccRefNumber","rootRangeNode","currentNode","_currentNode","left","right","isInLeft","max","isInRight","min","findPage","cccRefRangeTree","root","targetPageUrl","getCCCRefKey","v","isNaN","extractTextFromPage","page","paragraphText","extractTextFromPageParagraphs","footnotesText","extractTextFromPageFootnotes","pageParagraphs","mapper","PARAGRAPH_ELEMENT_TEXT_MAPPER","join","pageFootnotes","values","footnoteText","e","ref-anchor","ref-ccc","spacer","createSearchIndexes","asyncToGenerator","regenerator_default","mark","_callee","cccSnapshot","pageSnapshots","titleIndex","contentIndex","searchByTitle","searchByContent","wrap","_context","makeConciseCCCSnapshot","lunr","_this","this","field","forEach","entry","content","rest","objectWithoutProperties","add","_this2","title","createSearchHandler","abrupt","ready","stop","_x","apply","arguments","term","searchResult","createPageSnapshot","createEmptyIndexes","createEmptyLunrIndex","Home","components_App__WEBPACK_IMPORTED_MODULE_0__","Index","react__WEBPACK_IMPORTED_MODULE_0___default","n","react_router_dom__WEBPACK_IMPORTED_MODULE_1__","_Layout_Layout__WEBPACK_IMPORTED_MODULE_2__","_material_ui_core__WEBPACK_IMPORTED_MODULE_3__","components_common_hooks_useScrollToTopOnRouteChange__WEBPACK_IMPORTED_MODULE_4__","ul","& ul","& li:last-child","marginBottom","toc_link_tree","renderIndex","tocTree","renderIndexNode","tocLink","_tocNodes$id","renderedChildren","Fragment","renderedText","Search","searchIndex","useSearchIndexHook","_useState","useState","_useState2","searchTerm","setSearchTerm","_useState3","_useState4","doSearch","setDoSearch","_useState5","emptySearchResult","_useState6","setSearchResult","setImmediate","_Users_gibson_cheng_IdeaProjects_catechism_web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","_Users_gibson_cheng_IdeaProjects_catechism_web_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","searchMatches","getMatchingPages","react__WEBPACK_IMPORTED_MODULE_3___default","components_Layout_Layout__WEBPACK_IMPORTED_MODULE_4__","_material_ui_core__WEBPACK_IMPORTED_MODULE_5__","label","value","disabled","autoFocus","onChange","evt","target","_material_ui_core__WEBPACK_IMPORTED_MODULE_6__","_material_ui_icons__WEBPACK_IMPORTED_MODULE_7__","_SearchResults__WEBPACK_IMPORTED_MODULE_9__","indexSearchTerm","byTitle","byContent","setSearchIndex","hasLoaded","setHasLoaded","newIndex","createSearchIndex","sent","once","FLAG_ENABLE_SEARCH_PAGE","process","REACT_APP_FLAG_ENABLE_SEARCH_PAGE","SearchResultCard","Grid","item","xs","sm","md","Paper","paper","height","SearchResults","withWrapperContainer","searchResultsWrapper","searchResultsLabel","isEmptySearchTerm","labelDiv","hasNoMatchingResults","combinedEntries","spacing","SearchResultCard_SearchResultCard","result","minHeight","Boolean","hostname","ReactDOM","render","App","document","getElementById","navigator","serviceWorker","then","registration","unregister","HOME","PAGE","CCC_REFERENCE","SEARCH","_useCCCStoreHook","useCCCStoreHook","isLoaded","withStore","withStoreEnhancer","react_router_dom__WEBPACK_IMPORTED_MODULE_4__","react_router_dom__WEBPACK_IMPORTED_MODULE_5__","exact","component","Component","assign","undefined","setStore","loadRemoteStores","PUBLIC_FOLDER_URL","cccRequest","cccMetaRequest","_ref3","ccc","cccMeta","origin","request","uri","method","json","Promise","all","locationSearch","pageFilled","paragraphKeys","_","cccRefToParagraphMapper","createCCCRefToParagraphMapper","getCurrentFocusedElement","_Users_gibson_cheng_IdeaProjects_catechism_web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_3__","currentFocusedElement","setCurrentFocusedElement","createItemRefs","_Users_gibson_cheng_IdeaProjects_catechism_web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_2__","setElementRefs","resolvedElementKey","resolveFocusedElementKey","focusedElement","scrollToElement","resetElementRefs","focusedElementKey","resolvedKey","currentKey","cccRefs","filter","cccRef","keyToReset","updatedElementRef","footnoteNumber","refNumber","queryString","parse","elementMeta","offsetTop","SCROLL_TO_ELEMENT_OFFSET","Footer","footerContainer","Container","maxWidth","backgroundStyle","list","width","listHeader","borderBottom","listItem","appBar","alignItems","menuIcon","mainContainerWidth","toolbarContainerWidth","drawerState","setDrawerState","dismissDrawer","Layout_HideOnScroll","AppBar","style","boxShadow","Toolbar","DEFAULT_TOOLBAR_WIDTH","Menu","Layout_DummyToolbar","Drawer","open","onClose","List","disablePadding","ListItemText","disableTypography","ListItem","button","disableGutters","DEFAULT_MAIN_CONTAINER_WIDTH","Footer_Footer","HideOnScroll","trigger","useScrollTrigger","Slide","appear","direction","in","DummyToolbar"],"mappings":"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","file":"static/js/main.a85123d8.chunk.js","sourcesContent":["import { TocIdToUrlMap } from './cccMetaGenerator'\n\nexport interface UrlToTocIdMap {\n  [url: string]: string\n}\n\nexport const makeUrlToTocMap = (\n  tocIdToUrlMap: TocIdToUrlMap\n): UrlToTocIdMap => {\n  return Object.entries(tocIdToUrlMap).reduce((acc, [tocId, url]) => {\n    const urlWithoutShortLink = stripUrlShortLink(url)\n    return { ...acc, [urlWithoutShortLink]: tocId }\n  }, {})\n}\n\nconst SHORT_LINK_PATTERN = /\\+.*$/\nexport const stripUrlShortLink = (url: string) =>\n  url.replace(SHORT_LINK_PATTERN, '')\n","import { useEffect } from 'react'\n\nexport const useScrollToTopOnPathChange = (path: string) =>\n  useEffect(() => {\n    window.scrollTo(0, 0)\n  }, [path])\n","import React from 'react'\nimport { CCCEnhancedStore } from 'store/cccTypedefs'\nimport { Breadcrumbs, makeStyles, IconButton } from '@material-ui/core'\nimport { BreadcrumbsMap } from 'cccMetaGenerator/makeBreadcrumbs'\nimport { TOCNode, TOCNodes } from 'store/cccTypedefs'\nimport { Book } from '@material-ui/icons'\nimport { Link } from 'react-router-dom'\nimport { PageMetaMap } from 'cccMetaGenerator/makePageMetaMap'\nimport { APP_ROUTES } from 'components/App'\n\nconst useStyles = makeStyles({\n  container: {\n    padding: '20px 10px',\n    paddingBottom: 10,\n  },\n  breadcrumbs: {\n    fontFamily: 'inherit',\n  },\n})\n\ninterface PageBreadcrumbsProps {\n  store: CCCEnhancedStore\n  currentPageId: string\n}\n\nexport const PageBreadcrumbs: React.FC<PageBreadcrumbsProps> = props => {\n  const { store, currentPageId } = props\n  const {\n    extraMeta: { breadcrumbsMap, pageMetaMap },\n    store: { toc_nodes: tocNodes },\n  } = store\n  const styles = useStyles()\n\n  const breadcrumbTrail = findPageBreadcrumbTrail(\n    currentPageId,\n    breadcrumbsMap\n  ).map(getTocNode(tocNodes))\n  const lastIndex = breadcrumbTrail.length - 1\n\n  return (\n    <div className={styles.container}>\n      <Breadcrumbs className={styles.breadcrumbs}>\n        {createHomeBreadcrumb()}\n        {breadcrumbTrail.map(createBreadcrumbLink(pageMetaMap, lastIndex))}\n      </Breadcrumbs>\n    </div>\n  )\n}\n\nconst findPageBreadcrumbTrail = (\n  currentTocId: string,\n  breadcrumbsMap: BreadcrumbsMap\n): string[] => {\n  const current = breadcrumbsMap[currentTocId]\n\n  if (current.parent === '') {\n    return [currentTocId]\n  }\n\n  return [\n    ...findPageBreadcrumbTrail(current.parent, breadcrumbsMap),\n    currentTocId,\n  ]\n}\n\nconst createBreadcrumbText = (text: string, isLastIndex: boolean): string => {\n  if (isLastIndex) {\n    return text\n  }\n\n  return createShortenedBreadcrumbText(text)\n}\n\nconst createHomeBreadcrumb = () => {\n  return (\n    <Link to={APP_ROUTES.INDEX}>\n      <IconButton size='small'>\n        <Book />\n      </IconButton>\n    </Link>\n  )\n}\n\nconst createBreadcrumbLink = (pageMetaMap: PageMetaMap, lastIndex: number) =>\n  function BreadcrumbLink(tocNode: TOCNode, index: number) {\n    const { text, id } = tocNode\n    const isLastIndex = index === lastIndex\n    const breadcrumbText = createBreadcrumbText(text, isLastIndex)\n    const pageMeta = pageMetaMap[id]\n\n    if (!pageMeta) {\n      return <div key={index}>{breadcrumbText}</div>\n    }\n\n    return (\n      <Link to={`/p/${pageMeta.url}`} key={index}>\n        {breadcrumbText}\n      </Link>\n    )\n  }\n\nconst getTocNode = (tocNodes: TOCNodes) => (tocId: string): TOCNode =>\n  tocNodes[tocId]\n\nconst textsToReplace = [\n  [' one', '1'],\n  [' two', '2'],\n  [' three', '3'],\n  [' four', '4'],\n  [' five', '5'],\n  ['i.', '1'],\n  ['ii.', '2'],\n  ['iii.', '3'],\n  ['iv.', '4'],\n  ['v.', '5'],\n  ['vi.', '6'],\n  ['vii.', '7'],\n  ['viii.', '8'],\n  ['ix.', '9'],\n  ['x.', '10'],\n  ['xi.', '11'],\n]\n\nconst createShortenedBreadcrumbText = (text: string) => {\n  const shortenedText = textsToReplace.reduce(\n    (currText, args) => currText.replace(args[0], args[1]),\n    text.toLowerCase()\n  )\n\n  const numberInText = getNumberInText(shortenedText)\n  if (!numberInText) {\n    return text\n  }\n\n  return `${numberInText}.`\n}\n\nconst FIRST_NUMBER_PATTERN = /\\d/\nconst getNumberInText = (text: string) => {\n  const matches = text.match(FIRST_NUMBER_PATTERN)\n  if (!matches) {\n    return ''\n  }\n\n  return matches[0]\n}\n","import React, { createRef } from 'react'\nimport { makeStyles } from '@material-ui/styles'\nimport classnames from 'classnames'\nimport { WrapperRefMeta } from 'components/Page/pageScrollHooks'\n\ninterface HighlightWrapperProps {\n  refMeta?: WrapperRefMeta\n}\n\nexport const HighlightWrapper: React.FC<HighlightWrapperProps> = props => {\n  const { children, refMeta = emptyRefMeta } = props\n  const { highlighted, ref } = refMeta\n  const styles = useStyles()\n\n  return (\n    <div\n      className={classnames(styles.wrapper, {\n        [styles.highlighted]: highlighted,\n      })}\n      ref={ref}\n    >\n      {children}\n    </div>\n  )\n}\n\nconst useStyles = makeStyles({\n  wrapper: {\n    backgroundColor: '#24730000',\n    transitionProperty: 'background-color',\n    transitionDuration: '6s',\n  },\n  highlighted: {\n    backgroundColor: '#247300cc',\n  },\n})\n\nconst emptyRefMeta: WrapperRefMeta = {\n  highlighted: false,\n  ref: createRef(),\n}\n","import React from 'react'\nimport {\n  PageParagraph as PageParagraphType,\n  PageParagraphElement,\n  TextElement,\n} from '../../store/cccTypedefs'\nimport classnames from 'classnames'\nimport { makeStyles } from '@material-ui/styles'\nimport { WrapperRefMeta } from './pageScrollHooks'\nimport { HighlightWrapper } from 'components/HighlightWrapper/HighlightWrapper'\n\ninterface PageParagraphProps {\n  paragraph: PageParagraphType\n  wrapperRefMeta: WrapperRefMeta\n}\n\nexport const PageParagraph: React.FC<PageParagraphProps> = props => {\n  const styles = useStyles()\n\n  const { paragraph, wrapperRefMeta } = props\n  const { elements, attrs } = paragraph\n  return (\n    <HighlightWrapper refMeta={wrapperRefMeta}>\n      <p\n        className={classnames(styles.paragraph, {\n          [styles.paragraphIndented]: !!attrs.indent,\n        })}\n      >\n        {elements.map(renderParagraphElement(styles))}\n      </p>\n    </HighlightWrapper>\n  )\n}\n\nconst renderParagraphElement = (styles: Record<string, string>) => (\n  element: PageParagraphElement,\n  index: number\n) => {\n  switch (element.type) {\n    case 'spacer':\n      return <br key={index} />\n    case 'ref':\n      return <sup key={index}>{element.number}</sup>\n    case 'ref-anchor':\n      return (\n        <WithElementStyles element={element} key={index}>\n          <a href={element.link}>⇒</a>\n        </WithElementStyles>\n      )\n    case 'ref-ccc':\n      return (\n        <span key={index} className={styles.cccReferenceStyle}>\n          {element.ref_number}{' '}\n        </span>\n      )\n    case 'text':\n      return (\n        <WithElementStyles element={element} key={index}>\n          {element.text}\n        </WithElementStyles>\n      )\n    default:\n      return ''\n  }\n}\n\ninterface WithElementStylesProps {\n  element: PageParagraphElement\n}\nconst WithElementStyles: React.FC<WithElementStylesProps> = props => {\n  const styles = useStyles()\n  const element = props.element as TextElement\n  const { attrs = {} } = element\n\n  return (\n    <span\n      className={classnames(styles.elementTextDefaults, {\n        [styles.elementTextBold]: attrs.b,\n        [styles.elementTextItalicised]: attrs.i,\n      })}\n    >\n      {props.children}\n    </span>\n  )\n}\n\nconst useStyles = makeStyles({\n  paragraph: {\n    lineHeight: '1.5em',\n    margin: 0,\n    marginTop: '1em',\n    padding: '0 5px',\n  },\n  paragraphIndented: {\n    marginLeft: '2em',\n    marginRight: '2em',\n  },\n  cccReferenceStyle: {\n    borderLeft: '3px solid #b5b129',\n    marginLeft: -13,\n    paddingLeft: 10,\n  },\n  elementTextDefaults: {\n    display: 'inline',\n  },\n  elementTextBold: {\n    fontWeight: 'bold',\n  },\n  elementTextItalicised: {\n    fontStyle: 'italic',\n  },\n})\n","import React from 'react'\nimport {\n  PageFootnotes as PageFootnotesType,\n  PageFootnote as PageFootnoteType,\n  PageFootnoteRef,\n} from '../../store/cccTypedefs'\nimport { makeStyles } from '@material-ui/styles'\nimport { RefsMap, WrapperRefMeta, getFootnoteRefKey } from './pageScrollHooks'\nimport { HighlightWrapper } from 'components/HighlightWrapper/HighlightWrapper'\n\ninterface PageFoonotesProps {\n  footnotes: PageFootnotesType\n  wrapperRefMetas: RefsMap\n}\n\nexport const PageFootnotes: React.FC<PageFoonotesProps> = props => {\n  const { footnotes, wrapperRefMetas } = props\n  const styles = useStyles()\n\n  // TODO sort ascending\n  const footnoteKeys = Object.keys(footnotes)\n\n  const hasFootnotes = footnoteKeys.length > 0\n  if (!hasFootnotes) {\n    return null\n  }\n\n  return (\n    <div className={styles.pageFootnotesContainer}>\n      <h2 className={styles.pageFootnoteLabel}>Footnotes</h2>\n      {footnoteKeys.map((key, index) => {\n        const footnote = footnotes[key]\n        const wrapperRefMeta = wrapperRefMetas[getFootnoteRefKey(key)]\n\n        return (\n          <PageFootnote\n            footnote={footnote}\n            wrapperRefMeta={wrapperRefMeta}\n            key={index}\n          />\n        )\n      })}\n    </div>\n  )\n}\n\ninterface PageFootnoteProps {\n  footnote: PageFootnoteType\n  wrapperRefMeta: WrapperRefMeta\n}\nconst PageFootnote: React.FC<PageFootnoteProps> = props => {\n  const styles = useStyles()\n  const { footnote, wrapperRefMeta } = props\n  const { refs, number } = footnote\n\n  const footnoteNumberElement = (\n    <span key={-1} className={styles.footnoteRefStyle}>{`${number}. `}</span>\n  )\n\n  return (\n    <HighlightWrapper refMeta={wrapperRefMeta}>\n      <p className={styles.pageFootnote}>\n        {refs.reduce(renderFootnoteRefs, [footnoteNumberElement])}\n      </p>\n    </HighlightWrapper>\n  )\n}\n\nconst renderFootnoteRefs = (\n  acc: JSX.Element[],\n  curr: PageFootnoteRef,\n  index: number\n) => {\n  const shouldAddComma = index > 0\n  const renderedRef = <span key={index}>{curr.text}</span>\n\n  if (shouldAddComma) {\n    const commaElement = <span key={`${index}-comma`}>,</span>\n    return [...acc, commaElement, renderedRef]\n  }\n  return [...acc, renderedRef]\n}\n\nconst useStyles = makeStyles({\n  pageFootnotesContainer: {\n    marginTop: '2em',\n  },\n  pageFootnote: {\n    fontSize: '0.75em',\n    padding: 5,\n    margin: '5px 0',\n  },\n  pageFootnoteLabel: {\n    margin: 0,\n    fontWeight: 'normal',\n    color: 'gray',\n  },\n  footnoteRefStyle: {\n    borderLeft: '3px solid #247300',\n    marginLeft: -13,\n    paddingLeft: 10,\n  },\n})\n","import * as H from 'history'\n\nexport const historyPush = (history: H.History, url: string) =>\n  // eslint-disable-next-line fp/no-mutating-methods\n  history.push(url)\n","import React from 'react'\nimport { PageMetaMap } from '../../cccMetaGenerator/makePageMetaMap'\nimport { CCCEnhancedStore } from 'store/cccTypedefs'\nimport { Box, IconButton, makeStyles } from '@material-ui/core'\nimport { KeyboardArrowLeft, KeyboardArrowRight } from '@material-ui/icons'\nimport { historyPush } from '../../utils/reactRouterUtils'\nimport * as H from 'history'\n\ninterface PageControlsProps {\n  tocId: string\n  cccStore: CCCEnhancedStore\n  history: H.History\n}\n\nexport const PageControls: React.FC<PageControlsProps> = props => {\n  const styles = useStyles()\n  const { cccStore, history, tocId } = props\n\n  const { pageMetaMap } = cccStore.extraMeta\n  const { next, prev } = pageMetaMap[tocId]\n\n  const hasNext = hasUrl(next, pageMetaMap)\n  const hasPrev = hasUrl(prev, pageMetaMap)\n\n  return (\n    <Box className={styles.pageControls}>\n      {hasPrev && (\n        <IconButton\n          className={`${styles.pageControlButton} ${styles.pageLeftButton}`}\n          onClick={() =>\n            historyPush(history, `/p/${getUrl(prev, pageMetaMap)}`)\n          }\n        >\n          <KeyboardArrowLeft fontSize='large' />\n        </IconButton>\n      )}\n      {hasNext && (\n        <IconButton\n          className={`${styles.pageControlButton} ${styles.pageRightButton}`}\n          onClick={() =>\n            historyPush(history, `/p/${getUrl(next, pageMetaMap)}`)\n          }\n        >\n          <KeyboardArrowRight fontSize='large' />\n        </IconButton>\n      )}\n    </Box>\n  )\n}\n\nconst hasUrl = (tocId: string, pageMetaMap: PageMetaMap) => tocId in pageMetaMap\nconst getUrl = (tocId: string, pageMetaMap: PageMetaMap) =>\n  pageMetaMap[tocId].url\n\nconst useStyles = makeStyles({\n  pageControls: { display: 'flex', paddingTop: '2em', paddingBottom: '1em' },\n  pageLeftButton: {},\n  pageRightButton: { marginLeft: 'auto' },\n  pageControlButton: {\n    border: '1px solid rgba(0, 0, 0, 0.08)',\n  },\n})\n","import React from 'react'\nimport { stripUrlShortLink } from 'cccMetaGenerator/makeUrlMap'\nimport {\n  PageNode,\n  PageParagraph as PageParagraphType,\n  CCCEnhancedStore,\n} from 'store/cccTypedefs'\nimport { Layout } from 'components/Layout/Layout'\nimport { makeStyles } from '@material-ui/styles'\nimport { PageBreadcrumbs } from '../PageBreadcrumbs/PageBreadcrumbs'\nimport { AppRouteType } from 'components/App'\nimport { useScrollToTopOnPathChange } from '../common/hooks/useScrollToTopOnRouteChange'\nimport { PageParagraph } from './PageParagraph'\nimport { PageFootnotes } from './PageFootnotes'\nimport { PageControls } from './PageControls'\nimport { usePageScrollHooks, getParagraphRefKey } from './pageScrollHooks'\n\nexport const PAGE_TOC_ID_MATCH = 'PAGE_TOC_ID'\n\ninterface PageRouteParams {\n  [PAGE_TOC_ID_MATCH]: string\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\ninterface PageProps extends AppRouteType<PageRouteParams> {}\n\nexport const Page: React.FC<PageProps> = props => {\n  const { cccStore, location } = props\n  const styles = useStyles()\n\n  const shortUrl = getShortUrl(props)\n  const tocId = getPageTocId(cccStore, shortUrl)\n\n  useScrollToTopOnPathChange(tocId)\n  const pageNode = getPageNode(cccStore, tocId)\n  const elementRefs = usePageScrollHooks(pageNode, location.search)\n\n  if (!pageNode) {\n    return null\n  }\n\n  const { paragraphs, footnotes } = pageNode\n  const emptyTrailingParagraphIndexes = getTrailingEmptyParagraphIndexes(\n    paragraphs\n  )\n\n  return (\n    <Layout routeHistory={props.history}>\n      <PageBreadcrumbs store={cccStore} currentPageId={tocId} />\n      <div className={styles.pageContainer}>\n        {paragraphs.map((paragraph, index) => {\n          const isEmptyParagraph = emptyTrailingParagraphIndexes.has(index)\n          if (isEmptyParagraph) {\n            return null\n          }\n\n          const wrapperRefMeta = elementRefs[getParagraphRefKey(index)]\n\n          return (\n            <PageParagraph\n              paragraph={paragraph}\n              key={index}\n              wrapperRefMeta={wrapperRefMeta}\n            />\n          )\n        })}\n        <PageFootnotes footnotes={footnotes} wrapperRefMetas={elementRefs} />\n      </div>\n      <PageControls cccStore={cccStore} history={props.history} tocId={tocId} />\n    </Layout>\n  )\n}\n\nconst getShortUrl = (props: PageProps): string => {\n  const fullUrl = props.match.params[PAGE_TOC_ID_MATCH]\n  if (!fullUrl) {\n    return ''\n  }\n\n  return stripUrlShortLink(fullUrl)\n}\n\nconst getPageTocId = (cccStore: CCCEnhancedStore, shortUrl: string): string => {\n  return cccStore.extraMeta.urlMap[shortUrl] || ''\n}\nconst getPageNode = (\n  cccStore: CCCEnhancedStore,\n  tocId: string\n): PageNode | undefined => {\n  return cccStore.store.page_nodes[tocId]\n}\n\nconst isEmptyParagraph = (paragraph: PageParagraphType): boolean => {\n  const { elements } = paragraph\n  if (elements.length === 0) {\n    return true\n  }\n\n  if (elements.length === 1) {\n    const [firstElement] = elements\n    if (firstElement.type === 'spacer') {\n      return true\n    }\n  }\n\n  return false\n}\n\ninterface TrailingEmptyParagraphAccumulator {\n  ignoreRest: boolean\n  indexes: number[]\n}\n\nconst getTrailingEmptyParagraphIndexes = (\n  paragraphs: PageParagraphType[]\n): Set<number> => {\n  const emptyParagraphIndexes = paragraphs.reduceRight<\n    TrailingEmptyParagraphAccumulator\n  >(\n    (acc, paragraph, index) => {\n      if (acc.ignoreRest) {\n        return acc\n      }\n\n      if (isEmptyParagraph(paragraph)) {\n        return { ...acc, indexes: [...acc.indexes, index] }\n      }\n\n      return { ...acc, ignoreRest: true }\n    },\n    { ignoreRest: false, indexes: [] }\n  )\n\n  return new Set(emptyParagraphIndexes.indexes)\n}\n\nconst useStyles = makeStyles({\n  pageContainer: {\n    padding: '0 10px',\n  },\n})\n","import { getAllTocLinks } from './cccMetaGenerator'\nimport {\n  PageNode,\n  CCCRefElement,\n  TOCLink,\n  PageNodes,\n} from './../store/cccTypedefs'\nexport interface CCCRefRangeTree {\n  root: RangeTreeNode\n}\nexport interface RangeTreeNode {\n  left: RangeTreeNode | undefined\n  right: RangeTreeNode | undefined\n  min: number\n  max: number\n  tocId: string | undefined\n}\n\nexport const makeCCCRefRangeTree = (\n  tocLinkTree: TOCLink[],\n  pageNodes: PageNodes\n): CCCRefRangeTree => {\n  const tocIds = getAllTocLinks(tocLinkTree)\n  const tocIdsWithPages = tocIds.filter(tocId => tocId in pageNodes)\n\n  const rangeNodes: RangeTreeNode[] = tocIdsWithPages\n    .map(tocId => pageNodes[tocId])\n    .map(getRefRangeForPage)\n    .filter(n => !!n) as RangeTreeNode[]\n\n  /* eslint-disable  */\n  let remainingNodes: RangeTreeNode[] = [...rangeNodes]\n  let tempNodes: RangeTreeNode[] = []\n\n  while (remainingNodes.length > 1) {\n    const evenIndexes = remainingNodes.map((_, i) => i).filter(i => i % 2 === 0)\n    evenIndexes.forEach(i => {\n      const currentNode = remainingNodes[i]\n\n      const hasNextElement = !!remainingNodes[i + 1]\n      if (!hasNextElement) {\n        tempNodes.push(currentNode)\n        return\n      }\n\n      const nextNode = remainingNodes[i + 1]\n\n      const newParentNode: RangeTreeNode = {\n        left: currentNode,\n        right: nextNode,\n        min: currentNode.min,\n        max: nextNode.max,\n        tocId: undefined,\n      }\n      tempNodes.push(newParentNode)\n    })\n\n    remainingNodes = [...tempNodes]\n    tempNodes = []\n  }\n\n  /* eslint-enable  */\n  const rootNode = remainingNodes[0]\n  return { root: rootNode }\n}\n\nconst getRefRangeForPage = (pageNode: PageNode): RangeTreeNode | undefined => {\n  const { id, paragraphs } = pageNode\n\n  if (paragraphs.length === 0) {\n    return undefined\n  }\n\n  const paragraphElements = paragraphs\n    .map(p => p.elements)\n    .reduce((acc, curr) => [...acc, ...curr], [])\n  const cccRefNumbers = paragraphElements\n    .filter(e => e.type === 'ref-ccc')\n    .map(e => {\n      return (e as CCCRefElement).ref_number\n    })\n    .filter(n => n)\n\n  if (cccRefNumbers.length === 0) {\n    return undefined\n  }\n\n  return {\n    left: undefined,\n    right: undefined,\n    min: Math.min.apply(null, cccRefNumbers),\n    max: Math.max.apply(null, cccRefNumbers),\n    tocId: id,\n  }\n}\n\nexport const findPage = (\n  cccRefNumber: number,\n  rootRangeNode: RangeTreeNode\n): string | undefined => {\n  /* eslint-disable  */\n  let currentNode: RangeTreeNode = rootRangeNode\n\n  while (true) {\n    const { left, right } = currentNode\n    const isInLeft = !!left ? cccRefNumber <= left.max : false\n    const isInRight = !!right ? cccRefNumber >= right.min : false\n\n    if (isInLeft) {\n      currentNode = left as RangeTreeNode\n    } else if (isInRight) {\n      currentNode = right as RangeTreeNode\n    } else {\n      return undefined\n    }\n\n    if (!!currentNode.tocId) {\n      break\n    }\n  }\n\n  /* eslint-enable  */\n\n  return currentNode.tocId\n}\n","import React from 'react'\nimport { findPage } from 'cccMetaGenerator/makeRefRangeTree'\nimport { AppRouteType } from 'components/App'\nimport { getCCCRefKey } from 'components/Page/pageScrollHooks'\n\nexport const CCC_REFERENCE_MATCH = 'CCC_REFERENCE_MATCH'\n\ninterface PageRouteParams {\n  [CCC_REFERENCE_MATCH]: string\n}\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\ninterface CCCReferenceProps extends AppRouteType<PageRouteParams> {}\n\nexport const CCCReference: React.FC<CCCReferenceProps> = props => {\n  const cccReferenceMatch = props.match.params[CCC_REFERENCE_MATCH]\n  if (!cccReferenceMatch || !isNumber(cccReferenceMatch)) {\n    return null\n  }\n\n  const cccReferenceNumber = parseInt(cccReferenceMatch, 10)\n  const { cccStore } = props\n  const matchedPageId = findPage(\n    cccReferenceNumber,\n    cccStore.extraMeta.cccRefRangeTree.root\n  )\n\n  if (!matchedPageId) {\n    return null\n  }\n\n  const targetPageUrl = cccStore.extraMeta.pageMetaMap[matchedPageId].url\n  props.history.replace(\n    `/p/${targetPageUrl}?focus=${getCCCRefKey(cccReferenceNumber)}`\n  )\n\n  return null\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst isNumber = (v: any) => !isNaN(v as number)\n","import { CCCEnhancedStore } from 'store/cccTypedefs'\nimport {\n  PageNode,\n  PageParagraph,\n  PageParagraphElementType,\n  PageParagraphElement,\n  TextElement,\n  RefElement,\n  CCCRefElement,\n  PageFootnotes,\n} from '../../store/cccTypedefs'\n\nexport interface CCCPageSnapshot {\n  id: string\n  title: string\n  content: string\n}\n\nexport const createPageSnapshot = (\n  cccStore: CCCEnhancedStore,\n  tocId: string\n): CCCPageSnapshot => {\n  const { store } = cccStore\n  const { page_nodes, toc_nodes } = store\n\n  const { text: pageTitle } = toc_nodes[tocId]\n  const pageContent = extractTextFromPage(page_nodes[tocId])\n\n  return { title: pageTitle, content: pageContent, id: tocId }\n}\n\nexport const extractTextFromPage = (page: PageNode) => {\n  const { paragraphs, footnotes } = page\n\n  const paragraphText = extractTextFromPageParagraphs(paragraphs)\n  const footnotesText = extractTextFromPageFootnotes(footnotes)\n  return `${paragraphText}${footnotesText}`\n}\n\nexport const extractTextFromPageParagraphs = (\n  pageParagraphs: PageParagraph[]\n) => {\n  const texts = pageParagraphs\n    .map(paragraph => {\n      return paragraph.elements\n        .map(element => {\n          const mapper = PARAGRAPH_ELEMENT_TEXT_MAPPER[element.type]\n          return mapper(element)\n        })\n        .join('')\n    })\n    .join('\\n\\n')\n\n  return texts\n}\n\nexport const extractTextFromPageFootnotes = (pageFootnotes: PageFootnotes) => {\n  const texts = Object.values(pageFootnotes).map(footnote => {\n    const { number, refs } = footnote\n\n    const footnoteText = refs\n      .reduce<string[]>((acc, curr) => [...acc, curr.text], [])\n      .join(', ')\n\n    return `${number}: ${footnoteText}`\n  })\n\n  return texts.join('\\n')\n}\n\nconst PARAGRAPH_ELEMENT_TEXT_MAPPER: Record<\n  PageParagraphElementType,\n  (element: PageParagraphElement) => string\n> = {\n  text: e => {\n    const elm = e as TextElement\n    return `${elm.text}`\n  },\n  ref: e => {\n    const elm = e as RefElement\n    return `${elm.number}`\n  },\n  'ref-anchor': () => '',\n  'ref-ccc': e => {\n    const elm = e as CCCRefElement\n    return `${elm.ref_number} `\n  },\n  spacer: () => '\\n',\n}\n","import { createPageSnapshot, CCCPageSnapshot } from './createSearchIndexHelpers'\nimport { CCCEnhancedStore } from 'store/cccTypedefs'\nimport lunr from 'lunr'\n\nexport interface CCCSearchIndexes {\n  titleIndex: lunr.Index\n  contentIndex: lunr.Index\n  cccSnapshot: ConciseCCCSnapshot\n  searchByTitle: (term: string) => SearchEntry[]\n  searchByContent: (term: string) => SearchEntry[]\n  ready: boolean\n}\n\nexport const createSearchIndexes = async (\n  cccStore: CCCEnhancedStore\n): Promise<CCCSearchIndexes> => {\n  const cccSnapshot = makeConciseCCCSnapshot(cccStore)\n  const pageSnapshots = Object.values(cccSnapshot)\n\n  /* eslint-disable fp/no-this */\n  const titleIndex = lunr(function() {\n    this.ref('id')\n    this.field('title')\n\n    pageSnapshots.forEach(entry => {\n      const { content, ...rest } = entry\n      this.add(rest)\n    })\n  })\n\n  const contentIndex = lunr(function() {\n    this.ref('id')\n    this.field('content')\n\n    pageSnapshots.forEach(entry => {\n      const { title, ...rest } = entry\n      this.add(rest)\n    })\n  })\n  /* eslint-enable fp/no-this */\n\n  const searchByTitle = createSearchHandler(titleIndex, cccSnapshot)\n  const searchByContent = createSearchHandler(contentIndex, cccSnapshot)\n\n  return {\n    titleIndex,\n    contentIndex,\n    cccSnapshot,\n    searchByTitle,\n    searchByContent,\n    ready: true,\n  }\n}\n\nexport type SearchEntry = CCCPageSnapshot & lunr.Index.Result\n\nconst createSearchHandler = (\n  index: lunr.Index,\n  cccSnapshot: ConciseCCCSnapshot\n) => (term: string): SearchEntry[] => {\n  return index.search(term).map(searchResult => ({\n    ...searchResult,\n    ...cccSnapshot[searchResult.ref],\n  }))\n}\n\ninterface ConciseCCCSnapshot {\n  [tocId: string]: CCCPageSnapshot\n}\n\nexport const makeConciseCCCSnapshot = (\n  cccStore: CCCEnhancedStore\n): ConciseCCCSnapshot => {\n  const tocKeys = Object.keys(cccStore.extraMeta.pageMetaMap)\n  return tocKeys.reduce(\n    (acc, tocId) => ({ ...acc, [tocId]: createPageSnapshot(cccStore, tocId) }),\n    {}\n  )\n}\n\nexport const createEmptyIndexes = (): CCCSearchIndexes => {\n  return {\n    titleIndex: createEmptyLunrIndex(),\n    contentIndex: createEmptyLunrIndex(),\n    cccSnapshot: {},\n    searchByTitle: () => [],\n    searchByContent: () => [],\n    ready: false,\n  }\n}\n\nconst createEmptyLunrIndex = () => lunr(function() {})\n","import React from 'react'\nimport { RouteComponentProps } from 'react-router'\nimport { APP_ROUTES } from 'components/App'\n\nexport const Home: React.FC<RouteComponentProps> = props => {\n  props.history.replace(APP_ROUTES.INDEX)\n  return null\n}\n","import React from 'react'\nimport { Link } from 'react-router-dom'\nimport { TOCLink, TOCNodes } from 'store/cccTypedefs'\nimport { PageMetaMap } from 'cccMetaGenerator/makePageMetaMap'\nimport { Layout } from '../Layout/Layout'\nimport { makeStyles } from '@material-ui/core'\nimport { AppRouteType } from 'components/App'\nimport { useScrollToTopOnPathChange } from 'components/common/hooks/useScrollToTopOnRouteChange'\n\nconst useStyles = makeStyles({\n  container: {\n    // unexplained gap between toolbar and this page's outermost div\n    marginTop: -20,\n    padding: '20px 0',\n  },\n  ul: {\n    paddingLeft: 20,\n    lineHeight: 1.5,\n    '& ul': {\n      paddingLeft: 20,\n    },\n    '& li:last-child': {\n      marginBottom: 10,\n    },\n  },\n})\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\ninterface IndexProps extends AppRouteType {}\n\nexport const Index: React.FC<IndexProps> = props => {\n  const { cccStore } = props\n  const styles = useStyles()\n  useScrollToTopOnPathChange('')\n\n  const { store, extraMeta } = cccStore\n  const { toc_link_tree, toc_nodes } = store\n  const { pageMetaMap } = extraMeta\n\n  return (\n    <Layout routeHistory={props.history}>\n      <div className={styles.container}>\n        {renderIndex(toc_link_tree, toc_nodes, pageMetaMap, styles)}\n      </div>\n    </Layout>\n  )\n}\n\nconst renderIndex = (\n  tocTree: TOCLink[],\n  tocNodes: TOCNodes,\n  pageMetaMap: PageMetaMap,\n  styles: Record<string, string>\n) => {\n  return (\n    <ul className={styles.ul}>\n      {tocTree.map(renderIndexNode(tocNodes, pageMetaMap))}\n    </ul>\n  )\n}\n\nconst renderIndexNode = (\n  tocNodes: TOCNodes,\n  pageMetaMap: PageMetaMap\n  // eslint-disable-next-line react/display-name\n) => (tocLink: TOCLink, index: number) => {\n  const { children, id } = tocLink\n  const { text, link } = tocNodes[id]\n\n  const renderedChildren =\n    children.length > 0 ? (\n      <ul>{children.map(renderIndexNode(tocNodes, pageMetaMap))}</ul>\n    ) : (\n      <></>\n    )\n  const renderedText = link ? (\n    <Link to={`/p/${pageMetaMap[id].url}`}>{text}</Link>\n  ) : (\n    text\n  )\n\n  return (\n    <li key={index}>\n      {renderedText}\n      {renderedChildren}\n    </li>\n  )\n}\n","import React, { useState, useEffect } from 'react'\nimport { AppRouteType } from 'components/App'\nimport { Layout } from 'components/Layout/Layout'\nimport { TextField, IconButton } from '@material-ui/core'\nimport { Search as SearchIcon } from '@material-ui/icons'\nimport { useSearchIndexHook } from './useSearchIndexHook'\nimport { CCCSearchIndexes, SearchEntry } from './createSearchIndex'\nimport { SearchResults } from './SearchResults'\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\ninterface SearchProps extends AppRouteType {}\n\nexport const Search: React.FC<SearchProps> = props => {\n  const { cccStore } = props\n  const { searchIndex } = useSearchIndexHook(cccStore)\n\n  const [searchTerm, setSearchTerm] = useState('')\n  const [doSearch, setDoSearch] = useState(false)\n  const [searchResult, setSearchResult] = useState(emptySearchResult)\n\n  useEffect(() => {\n    if (!doSearch) {\n      return\n    }\n\n    const doSearchOperation = async () => {\n      const searchMatches = getMatchingPages(searchIndex, searchTerm)\n      setSearchResult(searchMatches)\n      setDoSearch(false)\n    }\n    setImmediate(doSearchOperation)\n  }, [doSearch, searchIndex, searchTerm, cccStore])\n\n  return (\n    <Layout routeHistory={props.history}>\n      <div>\n        <TextField\n          label='Search Term'\n          value={searchTerm}\n          disabled={doSearch}\n          autoFocus={true}\n          onChange={evt => setSearchTerm(evt.target.value)}\n        />\n        <IconButton onClick={() => setDoSearch(true)} disabled={doSearch}>\n          <SearchIcon />\n        </IconButton>\n      </div>\n      <div>\n        <SearchResults searchResult={searchResult} searchTerm={searchTerm} />\n      </div>\n    </Layout>\n  )\n}\n\nexport interface SearchResult {\n  byTitle: SearchEntry[]\n  byContent: SearchEntry[]\n}\n\nconst getMatchingPages = (\n  searchIndex: CCCSearchIndexes,\n  term: string\n): SearchResult => {\n  const { ready, searchByTitle, searchByContent } = searchIndex\n  if (!ready) {\n    return emptySearchResult\n  }\n\n  const indexSearchTerm = `${term}*`\n  const titleMatches = searchByTitle(indexSearchTerm)\n  const contentMatches = searchByContent(indexSearchTerm)\n  return { byTitle: titleMatches, byContent: contentMatches }\n}\n\nconst emptySearchResult: SearchResult = { byTitle: [], byContent: [] }\n","import {\n  createSearchIndexes,\n  CCCSearchIndexes,\n  createEmptyIndexes,\n} from './createSearchIndex'\nimport { CCCEnhancedStore } from 'store/cccTypedefs'\nimport { useState, useEffect } from 'react'\nimport { once } from 'ramda'\n\nexport const useSearchIndexHook = (cccStore: CCCEnhancedStore) => {\n  const [searchIndex, setSearchIndex] = useState<CCCSearchIndexes>(\n    createEmptyIndexes()\n  )\n  const [hasLoaded, setHasLoaded] = useState(false)\n\n  useEffect(() => {\n    if (hasLoaded) {\n      return\n    }\n\n    const loadSearchIndex = async () => {\n      const newIndex = await createSearchIndex(cccStore)\n      setSearchIndex(newIndex)\n      setHasLoaded(true)\n    }\n    // to make this non-blocking to UI thread\n    setImmediate(loadSearchIndex)\n  }, [cccStore, hasLoaded])\n\n  return {\n    searchIndex,\n  }\n}\n\nconst createSearchIndex: (\n  cccStore: CCCEnhancedStore\n) => Promise<CCCSearchIndexes> = once((cccStore: CCCEnhancedStore) =>\n  createSearchIndexes(cccStore)\n)\n","export const FLAG_ENABLE_SEARCH_PAGE =\n  process.env.REACT_APP_FLAG_ENABLE_SEARCH_PAGE === 'true'\n","import React from 'react'\nimport { SearchEntry } from './createSearchIndex'\nimport { Grid, Paper } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/styles'\n\ninterface SearchResultCardProps {\n  entry: SearchEntry\n}\n\nexport const SearchResultCard: React.FC<SearchResultCardProps> = props => {\n  const { entry } = props\n  const { title } = entry\n\n  const styles = useStyles()\n\n  return (\n    <Grid item xs={12} sm={6} md={4}>\n      <Paper className={styles.paper}>{title}</Paper>\n    </Grid>\n  )\n}\n\nconst useStyles = makeStyles({ paper: { height: '5em', padding: 20 } })\n","import React from 'react'\nimport { SearchResult } from './Search'\nimport { makeStyles } from '@material-ui/styles'\nimport { Grid } from '@material-ui/core'\nimport { SearchResultCard } from './SearchResultCard'\n\ninterface SearchResultsProps {\n  searchResult: SearchResult\n  searchTerm: string\n}\n\nexport const SearchResults: React.FC<SearchResultsProps> = props => {\n  const styles = useStyles()\n  const { searchResult, searchTerm } = props\n\n  const withWrapperContainer = (element: JSX.Element) => (\n    <div className={styles.searchResultsWrapper}>\n      <div className={styles.searchResultsLabel}>Search Results</div>\n      {element}\n    </div>\n  )\n\n  if (isEmptySearchTerm(searchTerm)) {\n    return withWrapperContainer(\n      <div className={styles.labelDiv}>No Search Term</div>\n    )\n  }\n\n  if (hasNoMatchingResults(searchResult)) {\n    return withWrapperContainer(\n      <div className={styles.labelDiv}>No Matching Results</div>\n    )\n  }\n\n  const { byTitle, byContent } = searchResult\n  const combinedEntries = [...byTitle, ...byContent]\n  return withWrapperContainer(\n    <Grid container spacing={3}>\n      {combinedEntries.map((entry, index) => (\n        <SearchResultCard entry={entry} key={index} />\n      ))}\n    </Grid>\n  )\n}\n\nconst isEmptySearchTerm = (term: string): boolean => term === ''\n\nconst hasNoMatchingResults = (result: SearchResult): boolean => {\n  const { byTitle, byContent } = result\n  const totalResults = byTitle.length + byContent.length\n\n  return totalResults === 0\n}\n\nconst useStyles = makeStyles({\n  searchResultsWrapper: {\n    paddingTop: '1em',\n    paddingBottom: '1em',\n    minHeight: 200,\n  },\n  searchResultsLabel: {\n    fontWeight: 'bold',\n    color: 'gray',\n    marginBottom: '0.5em',\n  },\n  labelDiv: { height: '100%', color: 'gray' },\n})\n","/* eslint-disable fp/no-mutation */\n\n// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\ninterface Config {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\n}\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    )\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          // eslint-disable-next-line no-console\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              // eslint-disable-next-line no-console\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              // eslint-disable-next-line no-console\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      // eslint-disable-next-line no-console\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      // eslint-disable-next-line no-console\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport * as serviceWorker from './serviceWorker'\nimport { App } from './components/App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n","import React, { useEffect, useState } from 'react'\nimport { HashRouter, Route, RouteComponentProps } from 'react-router-dom'\nimport { Home } from './Home/Home'\nimport { PAGE_TOC_ID_MATCH, Page } from './Page/Page'\nimport { Index } from './Index/Index'\nimport { CCC_REFERENCE_MATCH, CCCReference } from './CCCReference/CCCReference'\nimport { CCCEnhancedStore } from 'store/cccTypedefs'\nimport { Search } from './Search/Search'\nimport request from 'request-promise-native'\nimport { FLAG_ENABLE_SEARCH_PAGE } from 'components/common/featureFlags'\n\ntype AppRouteKeys = 'HOME' | 'PAGE' | 'INDEX' | 'CCC_REFERENCE' | 'SEARCH'\ntype AppRoutes = Record<AppRouteKeys, string>\n\nexport const APP_ROUTES: AppRoutes = {\n  HOME: '/',\n  PAGE: `/p/:${PAGE_TOC_ID_MATCH}`,\n  INDEX: '/index',\n  CCC_REFERENCE: `/r/:${CCC_REFERENCE_MATCH}`,\n  SEARCH: `/s`,\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport interface AppRouteType<TRouteParams = any>\n  extends RouteComponentProps<TRouteParams> {\n  cccStore: CCCEnhancedStore\n}\n\nexport const App: React.FC = () => {\n  const { isLoaded, store: cccStore } = useCCCStoreHook()\n  const withStore = withStoreEnhancer(cccStore as CCCEnhancedStore)\n\n  if (!isLoaded) {\n    return null\n  }\n\n  return (\n    <HashRouter>\n      <Route path={APP_ROUTES.HOME} exact component={withStore(Home)}></Route>\n      <Route path={APP_ROUTES.INDEX} component={withStore(Index)}></Route>\n      <Route path={APP_ROUTES.PAGE} component={withStore(Page)}></Route>\n      {FLAG_ENABLE_SEARCH_PAGE && (\n        <Route path={APP_ROUTES.SEARCH} component={withStore(Search)}></Route>\n      )}\n      <Route\n        path={APP_ROUTES.CCC_REFERENCE}\n        component={withStore(CCCReference)}\n      ></Route>\n    </HashRouter>\n  )\n}\n\nconst withStoreEnhancer = (store: CCCEnhancedStore) => (\n  Component: React.FC<AppRouteType>\n) =>\n  function withStoreEnhancer(props: RouteComponentProps) {\n    return <Component {...props} cccStore={store} />\n  }\n\nconst useCCCStoreHook = () => {\n  const [store, setStore] = useState<CCCEnhancedStore | undefined>(undefined)\n\n  useEffect(() => {\n    if (!store) {\n      setImmediate(() => loadRemoteStores(setStore))\n    }\n  }, [store])\n\n  return { store, isLoaded: !!store }\n}\n\nconst loadRemoteStores = async (\n  setStore: (store: CCCEnhancedStore) => void\n) => {\n  const PUBLIC_FOLDER_URL = window.location.origin\n\n  const cccRequest = () =>\n    request({\n      uri: `${PUBLIC_FOLDER_URL}/ccc/ccc.json`,\n      method: 'GET',\n      json: true,\n    })\n  const cccMetaRequest = () =>\n    request({\n      uri: `${PUBLIC_FOLDER_URL}/ccc/cccMeta.json`,\n      method: 'GET',\n      json: true,\n    })\n\n  const [ccc, cccMeta] = await Promise.all([cccRequest(), cccMetaRequest()])\n  setStore({ store: ccc, extraMeta: cccMeta })\n}\n","import { CCCRefElement } from '../../store/cccTypedefs'\nimport { createRef, useState, useEffect } from 'react'\nimport { PageNode, PageParagraph } from 'store/cccTypedefs'\nimport queryString from 'query-string'\n\nexport interface RefsMap {\n  [index: string]: WrapperRefMeta\n}\n\nexport interface WrapperRefMeta {\n  ref: React.RefObject<HTMLDivElement>\n  highlighted: boolean\n}\n\nexport const usePageScrollHooks = (\n  page: PageNode | undefined,\n  locationSearch: string\n): RefsMap => {\n  const pageFilled = page || { id: '', paragraphs: [], footnotes: {} }\n  const { paragraphs, footnotes } = pageFilled\n\n  const paragraphKeys = paragraphs.map((_, index) => getParagraphRefKey(index))\n  const footnoteKeys = Object.keys(footnotes).map(getFootnoteRefKey)\n  const cccRefToParagraphMapper = createCCCRefToParagraphMapper(paragraphs)\n\n  const [currentFocusedElement, setCurrentFocusedElement] = useState(\n    getCurrentFocusedElement(locationSearch)\n  )\n  const [elementRefs, setElementRefs] = useState(\n    createItemRefs(\n      [...paragraphKeys, ...footnoteKeys],\n      currentFocusedElement,\n      cccRefToParagraphMapper\n    )\n  )\n\n  useEffect(() => {\n    if (currentFocusedElement === '') {\n      return\n    }\n\n    const resolvedElementKey = resolveFocusedElementKey(\n      cccRefToParagraphMapper,\n      currentFocusedElement\n    )\n    const focusedElement = elementRefs[resolvedElementKey]\n    if (!focusedElement) {\n      setCurrentFocusedElement('')\n      return\n    }\n\n    scrollToElement(focusedElement)\n    setElementRefs(resetElementRefs(elementRefs, resolvedElementKey))\n    setCurrentFocusedElement('')\n  }, [currentFocusedElement, elementRefs, cccRefToParagraphMapper])\n\n  return elementRefs\n}\n\nconst createItemRefs = (\n  keys: string[],\n  focusedElementKey: string,\n  cccRefToParagraphMapper: CCCRefToParagraphMapper\n): RefsMap => {\n  const resolvedKey = resolveFocusedElementKey(\n    cccRefToParagraphMapper,\n    focusedElementKey\n  )\n  return keys.reduce(\n    (acc, currentKey) => ({\n      ...acc,\n      [currentKey]: {\n        ref: createRef(),\n        highlighted: currentKey === resolvedKey,\n      },\n    }),\n    {}\n  )\n}\n\ninterface CCCRefToParagraphMapper {\n  [cccRef: string]: string\n}\n\nconst createCCCRefToParagraphMapper = (\n  paragraphs: PageParagraph[]\n): CCCRefToParagraphMapper =>\n  paragraphs.reduce((acc, curr, index) => {\n    const cccRefs = curr.elements.filter(e => e.type === 'ref-ccc')\n    if (cccRefs.length === 0) {\n      return acc\n    }\n\n    const cccRef = cccRefs[0] as CCCRefElement\n    return {\n      ...acc,\n      [getCCCRefKey(cccRef.ref_number)]: getParagraphRefKey(index),\n    }\n  }, {})\n\nconst resetElementRefs = (\n  elementRefs: RefsMap,\n  keyToReset: string\n): RefsMap => {\n  const updatedElementRef: WrapperRefMeta = {\n    ...elementRefs[keyToReset],\n    highlighted: false,\n  }\n  return { ...elementRefs, [keyToReset]: updatedElementRef }\n}\n\nexport const getParagraphRefKey = (index: number) => `paragraph-${index + 1}`\n\nexport const getFootnoteRefKey = (footnoteNumber: string) =>\n  `footnote-${footnoteNumber}`\n\nexport const getCCCRefKey = (refNumber: number) => `ccc-${refNumber}`\n\nconst resolveFocusedElementKey = (\n  cccRefToParagraphMapper: CCCRefToParagraphMapper,\n  currentFocusedElement: string\n): string => {\n  return currentFocusedElement in cccRefToParagraphMapper\n    ? cccRefToParagraphMapper[currentFocusedElement]\n    : currentFocusedElement\n}\n\nconst getCurrentFocusedElement = (locationSearch: string): string => {\n  const params = queryString.parse(locationSearch)\n\n  const focusedElement = (params['focus'] as string) || ''\n  return focusedElement\n}\n\nconst scrollToElement = (elementMeta: WrapperRefMeta) => {\n  const current = elementMeta.ref.current as HTMLDivElement\n  window.scrollTo(0, current.offsetTop - SCROLL_TO_ELEMENT_OFFSET)\n}\n\nconst SCROLL_TO_ELEMENT_OFFSET = 100\n","import React from 'react'\nimport { makeStyles } from '@material-ui/styles'\nimport { Container } from '@material-ui/core'\n\nexport const Footer: React.FC = () => {\n  const styles = useStyles()\n\n  return (\n    <div className={styles.footerContainer}>\n      <Container maxWidth='md'>\n        <b>Catechism of the Catholic Church</b>\n        <div>© Libreria Editrice Vaticana</div>\n        <div>© St. Charles Borromeo Catholic Church</div>\n      </Container>\n    </div>\n  )\n}\n\nconst useStyles = makeStyles({\n  footerContainer: {\n    fontSize: '0.75em',\n    backgroundColor: '#f7f0d8',\n    padding: '2em 0',\n  },\n})\n","import React, { useState } from 'react'\nimport {\n  Drawer,\n  AppBar,\n  Toolbar,\n  useScrollTrigger,\n  Slide,\n  Container,\n  List,\n  ListItem,\n  ListItemText,\n  makeStyles,\n  Box,\n} from '@material-ui/core'\nimport { Menu } from '@material-ui/icons'\nimport { APP_ROUTES } from 'components/App'\nimport { Footer } from 'components/Footer/Footer'\nimport * as H from 'history'\n\nconst useStyles = makeStyles({\n  backgroundStyle: { backgroundColor: 'white' },\n  list: {\n    fontFamily: 'Cinzel',\n    width: 250,\n  },\n  listHeader: {\n    fontSize: '1.5em',\n    padding: 20,\n    margin: 0,\n    marginTop: 10,\n    borderBottom: '1px solid gray',\n  },\n  listItem: { padding: 20 },\n  appBar: {\n    fontFamily: 'Cinzel',\n    display: 'flex',\n    alignItems: 'center',\n    fontSize: '1.4em',\n  },\n  menuIcon: {\n    marginRight: 10,\n  },\n})\n\ntype MUIContainerWidth = 'xs' | 'sm' | 'md' | 'lg' | 'xl' | false\n\ninterface LayoutProps {\n  routeHistory: H.History\n  toolbarContainerWidth?: MUIContainerWidth\n  mainContainerWidth?: MUIContainerWidth\n}\n\nexport const Layout: React.FC<LayoutProps> = props => {\n  const styles = useStyles()\n  const { mainContainerWidth, toolbarContainerWidth } = props\n  const [drawerState, setDrawerState] = useState(false)\n\n  const dismissDrawer = () => setDrawerState(false)\n\n  return (\n    <div>\n      <HideOnScroll>\n        <AppBar color='default' style={{ boxShadow: 'none' }}>\n          <Toolbar>\n            <Container\n              maxWidth={toolbarContainerWidth || DEFAULT_TOOLBAR_WIDTH}\n              className={styles.appBar}\n            >\n              <Menu\n                onClick={() => setDrawerState(true)}\n                className={styles.menuIcon}\n              />\n              Catechism\n            </Container>\n          </Toolbar>\n        </AppBar>\n      </HideOnScroll>\n      <DummyToolbar />\n      <Drawer open={drawerState} onClose={dismissDrawer}>\n        <Box className={styles.list}>\n          <List component='nav' disablePadding>\n            <ListItemText disableTypography className={styles.listHeader}>\n              Catechism\n            </ListItemText>\n            <ListItem\n              button\n              disableGutters\n              className={styles.listItem}\n              onClick={() => {\n                // eslint-disable-next-line fp/no-mutating-methods\n                props.routeHistory.push(APP_ROUTES.INDEX)\n                dismissDrawer()\n              }}\n            >\n              Index\n            </ListItem>\n          </List>\n        </Box>\n      </Drawer>\n      <div className={styles.backgroundStyle}>\n        <Container\n          maxWidth={mainContainerWidth || DEFAULT_MAIN_CONTAINER_WIDTH}\n        >\n          {props.children}\n        </Container>\n      </div>\n      <Footer />\n    </div>\n  )\n}\n\nconst HideOnScroll: React.FC = props => {\n  const trigger = useScrollTrigger()\n\n  return (\n    <Slide appear={false} direction='down' in={!trigger}>\n      {props.children}\n    </Slide>\n  )\n}\n\nconst DummyToolbar: React.FC = () => {\n  const styles = useStyles()\n  return (\n    <div className={styles.backgroundStyle}>\n      <Toolbar />\n    </div>\n  )\n}\n\nconst DEFAULT_MAIN_CONTAINER_WIDTH = 'md'\nconst DEFAULT_TOOLBAR_WIDTH = 'md'\n"],"sourceRoot":""}